from itertools import combinations
import math


def coefficient(list1, list2):      #计算l2中对应于列表l1中为0的位置的成绩，为该项的系数
	the_coefficient = 1
	for i in range(len(list1)):
		if list1[i] == 0:
			the_coefficient *= list2[i]
	return the_coefficient


def single_items(n, k):       #给出n和k，得到所有n长且有k位是1的状态
	all_list = []
	n_group = []
	for i in range(n):
		n_group.append(i)
	all_comb = list(combinations(n_group, k))
	j = 0
	while j < len(all_comb):
		base_list = [0] * n
		for i in range(k):
			base_list[all_comb[j][i]] = 1
		all_list.append(base_list.copy())
		base_list.clear()
		j += 1
	return all_list


def mul_items(list_c):      #给一个n长序列，得到(x1+c1+1)(x2+c2+1)...(xn+cn+1)的所有项
	order = len(list_c)
	c_list = [0] * order
	mul_list = []
	for i in range(order):
		c_list[i] = 1 - list_c[i]
	j = order
	while j > 0:
		all_k = single_items(order, j)
		for i in range(len(all_k)):
			if coefficient(all_k[i], c_list) == 0:
				continue
			mul_list.append(all_k[i])
		j -= 1
	return mul_list


def strs(list1):        #给一个列表，表示成字符的形式
	the_str = ''
	for i in range(len(list1)):
		if list1[i] == 1:
			the_str += 'x{}'.format(i)
	return the_str


def feedback_function(de_sequence):  #给一个debruijn序列，先求出所有需要计算项的序列，然后利用项函数得到各项，相加
	order = int(math.log(len(de_sequence), 2))
	expaision = []
	expaision_str = ''
	for i in range(order, len(de_sequence)):
		if de_sequence[i] == 1:
			mul_item = mul_items(de_sequence[i-order:i])
			for single_item in mul_item:
				if single_item in expaision:
					expaision.remove(single_item)
				else:
					expaision.append(single_item)
	alpha_list = [0] * (order-1)
	sub_list = mul_items(alpha_list)
	for single_item in sub_list:
		sub_item = [0] + single_item
		if sub_item in expaision:
			expaision.remove(sub_item)
		else:
			expaision.append(sub_item)
	if len(expaision) == 0:
		return 0
	for i in range(len(expaision)-1):
		expaision_str += strs(expaision[i])
		expaision_str += '+'
	expaision_str += strs(expaision[-1])
	return expaision_str


def feedback_function_str(de_sequence_str):
	de_sequence = []
	for i in range(len(de_sequence_str)):
		de_sequence.append(int(de_sequence_str[i]))
	return feedback_function(de_sequence)


# d = '0000111101100101'
# print(feedback_function_str(d))
sequence_list = ['0000001111110110100100110111010101100101000101111001110001100001', '0000001010111000111011001001011011111100110000110100111101010001',
				 '0000001000011010011110101000101011100011101100100101101111110011', '0000001000011000111001011001111110110111010001010010011010101111',
				 '0000001000011000111001001011001111010001010011010101110110111111', '0000001101111110011100011110101000101011001001011101101001100001',
				 '0000001011001111010011010101110110111111000110000111001001010001', '0000001100011100100101100111101000101001101010111011011111100001',
				 '0000001111110111100111000110110100110000101110101100101010001001', '0000001110011110001101101011101111110100110000101100101010001001',
				 '0000001001011011111101100111100100010101110101001101000011000111', '0000001001011011001000101010011010111011111101000011000111001111',
				 '0000001001011011001000101010011010111010000110001110011110111111', '0000001001000101101100101010000111010111000110100111111011110011',
				 '0000001001011111101110101101100100010101001101000011000111100111', '0000001001011011001000101010011010111010000110001110011111101111',
				 '0000001001111110110111010101111000111001011000011001101000101001', '0000001000011000101000111111011010010011011101010110010111100111',
				 '0000001000011001101000101001111010101110110111111000111001001011', '0000001000011000101000111001001011001101001111010101110110111111',
				 '0000001101111110011100011110101000101011001001011101101001100001', '0000001011001101001111010101110110111111000110000111001001010001',
				 '0000001100010100011100100101100110100111101010111011011111100001', '0000001000011000101000111001001011001101001111010101110110111111',
				 '0000001111001110001101101001100001011111101110101100101010001001', '0000001001101011101111110100101101100111100100011100010101000011',
				 '0000001001111001101001011011111101100100011100010101110101000011', '0000001001111001101001011011001000111000101011111101110101000011',
				 '0000001001000101101100101010000111010111001111110111100011010011', '0000001001101001011101011011001000111101111110011100010101000011',
				 '0000001001111110111100110100101101100100011100010101110101000011', '0000001001111001101001011011001000111000101011111101110101000011']
for sequence in sequence_list:
	print('The deBruin sequence：', sequence)
	print('The feedback function:', feedback_function_str(sequence))
	print('\n')
